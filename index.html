<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Package, Truck, Clock, Plus, RefreshCw, Edit2 } = lucide;

        // REPLACE THESE WITH YOUR SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://aqyfwmbbprnyldxfkabz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxeWZ3bWJicHJueWxkeGZrYWJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxOTIyNjIsImV4cCI6MjA3MDc2ODI2Mn0.tOB-aFn1C8MIjy4ep9Y-sQGjxyf-_rsY-LIGzFSxvh8';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const PackageTrackingApp = () => {
            const [packages, setPackages] = useState([]);
            const [newTracking, setNewTracking] = useState('');
            const [newNickname, setNewNickname] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [editNickname, setEditNickname] = useState('');

            useEffect(() => {
                loadPackages();
            }, []);

            const loadPackages = async () => {
                try {
                    const { data, error } = await supabase
                        .from('packages')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    setPackages(data || []);
                } catch (error) {
                    console.error('Error loading packages:', error);
                }
            };

            const detectCarrier = (trackingNumber) => {
                const cleaned = trackingNumber.replace(/\s+/g, '').toUpperCase();
                
                if (/^1Z[0-9A-Z]{16}$/.test(cleaned)) return 'UPS';
                if (/^[0-9]{12}$/.test(cleaned) || /^[0-9]{14}$/.test(cleaned)) return 'FedEx';
                if (/^[0-9]{15}$/.test(cleaned)) return 'FedEx';
                if (/^[0-9]{20}$/.test(cleaned)) return 'FedEx';
                if (/^(94|93|92|94)[0-9]{20}$/.test(cleaned)) return 'USPS';
                if (/^[A-Z]{2}[0-9]{9}[A-Z]{2}$/.test(cleaned)) return 'USPS';
                if (/^[0-9]{10,11}$/.test(cleaned)) return 'DHL';
                if (/^[0-9]{4}[0-9]{4}[0-9]{2}$/.test(cleaned)) return 'DHL';
                if (/^TBA[0-9]{12}$/.test(cleaned)) return 'Amazon';
                if (/^[A-Z]{2}[0-9]{9}[A-Z]{2}$/.test(cleaned)) return '17track';
                if (/^[0-9]{13}$/.test(cleaned)) return '17track';
                if (/^LP[0-9]{11}[A-Z]{2}$/.test(cleaned)) return '17track';
                if (/^[A-Z]{1}[A-Z0-9]{1}[0-9]{9}[A-Z]{2}$/.test(cleaned)) return '17track';
                if (/^YT[0-9]{16}$/.test(cleaned)) return '17track';
                
                return 'Unknown';
            };

            const getCarrierColors = (carrier) => {
                const colors = {
                    'UPS': { primary: '#8B4513', secondary: '#D2691E', bg: '#FFF8DC', text: '#654321' },
                    'FedEx': { primary: '#4B0082', secondary: '#FF6B35', bg: '#F8F4FF', text: '#4B0082' },
                    'USPS': { primary: '#004B87', secondary: '#ED1C24', bg: '#F0F8FF', text: '#003366' },
                    'DHL': { primary: '#FFCC00', secondary: '#DC143C', bg: '#FFFACD', text: '#B8860B' },
                    'Amazon': { primary: '#FF9900', secondary: '#146EB4', bg: '#FFF4E6', text: '#E47911' },
                    '17track': { primary: '#2563EB', secondary: '#1D4ED8', bg: '#EFF6FF', text: '#1E40AF' },
                    'Unknown': { primary: '#6B7280', secondary: '#9CA3AF', bg: '#F9FAFB', text: '#374151' }
                };
                return colors[carrier] || colors['Unknown'];
            };

            const generateMockTrackingData = (trackingNumber, carrier) => {
                const statuses = ['Label Created', 'Package Accepted', 'In Transit', 'Out for Delivery', 'Delivered'];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                const deliveryDate = new Date();
                deliveryDate.setDate(deliveryDate.getDate() + Math.floor(Math.random() * 5) + 1);
                
                return {
                    status: randomStatus,
                    estimated_delivery: deliveryDate.toLocaleDateString(),
                    last_update: new Date().toLocaleString(),
                    location: 'Distribution Center'
                };
            };

            const addPackage = async () => {
                if (!newTracking.trim()) return;
                
                setIsLoading(true);
                
                try {
                    const carrier = detectCarrier(newTracking);
                    const trackingData = generateMockTrackingData(newTracking, carrier);
                    
                    const { data, error } = await supabase
                        .from('packages')
                        .insert([{
                            tracking_number: newTracking.trim(),
                            nickname: newNickname.trim() || `Package ${packages.length + 1}`,
                            carrier,
                            ...trackingData
                        }])
                        .select();
                    
                    if (error) throw error;
                    
                    setPackages([...data, ...packages]);
                    setNewTracking('');
                    setNewNickname('');
                } catch (error) {
                    console.error('Error adding package:', error);
                    alert('Failed to add package. Please check your database connection.');
                }
                
                setIsLoading(false);
            };

            const refreshPackage = async (packageId) => {
                setIsLoading(true);
                
                try {
                    const pkg = packages.find(p => p.id === packageId);
                    const updatedData = generateMockTrackingData(pkg.tracking_number, pkg.carrier);
                    
                    const { error } = await supabase
                        .from('packages')
                        .update({
                            ...updatedData,
                            last_update: new Date().toLocaleString()
                        })
                        .eq('id', packageId);
                    
                    if (error) throw error;
                    
                    setPackages(packages.map(p => 
                        p.id === packageId ? { ...p, ...updatedData } : p
                    ));
                } catch (error) {
                    console.error('Error updating package:', error);
                    alert('Failed to update package.');
                }
                
                setIsLoading(false);
            };

            const updateNickname = async (packageId, newNickname) => {
                try {
                    const { error } = await supabase
                        .from('packages')
                        .update({ nickname: newNickname })
                        .eq('id', packageId);
                    
                    if (error) throw error;
                    
                    setPackages(packages.map(pkg => 
                        pkg.id === packageId ? { ...pkg, nickname: newNickname } : pkg
                    ));
                    setEditingId(null);
                    setEditNickname('');
                } catch (error) {
                    console.error('Error updating nickname:', error);
                    alert('Failed to update nickname.');
                }
            };

            const removePackage = async (packageId) => {
                try {
                    const { error } = await supabase
                        .from('packages')
                        .delete()
                        .eq('id', packageId);
                    
                    if (error) throw error;
                    
                    setPackages(packages.filter(pkg => pkg.id !== packageId));
                } catch (error) {
                    console.error('Error deleting package:', error);
                    alert('Failed to delete package.');
                }
            };

            return React.createElement('div', { className: "max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen" },
                React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
                    React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-6 flex items-center" },
                        React.createElement(Package, { className: "mr-3 text-blue-600" }),
                        "Package Tracker"
                    ),
                    React.createElement('div', { className: "bg-gray-50 p-4 rounded-lg mb-6" },
                        React.createElement('h2', { className: "text-xl font-semibold mb-4" }, "Add New Package"),
                        React.createElement('div', { className: "flex flex-col sm:flex-row gap-3" },
                            React.createElement('input', {
                                type: "text",
                                placeholder: "Enter tracking number",
                                value: newTracking,
                                onChange: (e) => setNewTracking(e.target.value),
                                className: "flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            }),
                            React.createElement('input', {
                                type: "text",
                                placeholder: "Package nickname (optional)",
                                value: newNickname,
                                onChange: (e) => setNewNickname(e.target.value),
                                className: "flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            }),
                            React.createElement('button', {
                                onClick: addPackage,
                                disabled: isLoading || !newTracking.trim(),
                                className: "px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center"
                            },
                                isLoading ? React.createElement(RefreshCw, { className: "w-4 h-4 animate-spin mr-2" }) : React.createElement(Plus, { className: "w-4 h-4 mr-2" }),
                                "Add Package"
                            )
                        )
                    )
                ),
                React.createElement('div', { className: "space-y-4" },
                    packages.length === 0 ? 
                        React.createElement('div', { className: "bg-white rounded-lg shadow p-8 text-center" },
                            React.createElement(Package, { className: "w-16 h-16 text-gray-300 mx-auto mb-4" }),
                            React.createElement('p', { className: "text-gray-500 text-lg" }, "No packages tracked yet"),
                            React.createElement('p', { className: "text-gray-400" }, "Add a tracking number above to get started")
                        ) :
                        packages.map((pkg) => {
                            const colors = getCarrierColors(pkg.carrier);
                            return React.createElement('div', {
                                key: pkg.id,
                                className: "bg-white rounded-lg shadow-md overflow-hidden",
                                style: { borderLeft: `6px solid ${colors.primary}` }
                            },
                                React.createElement('div', { 
                                    className: "p-6", 
                                    style: { backgroundColor: colors.bg } 
                                },
                                    React.createElement('div', { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4" },
                                        React.createElement('div', { className: "flex-1" },
                                            editingId === pkg.id ?
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('input', {
                                                        type: "text",
                                                        value: editNickname,
                                                        onChange: (e) => setEditNickname(e.target.value),
                                                        className: "text-xl font-bold bg-white border border-gray-300 rounded px-2 py-1",
                                                        onKeyPress: (e) => e.key === 'Enter' && updateNickname(pkg.id, editNickname),
                                                        autoFocus: true
                                                    }),
                                                    React.createElement('button', {
                                                        onClick: () => updateNickname(pkg.id, editNickname),
                                                        className: "text-green-600 hover:text-green-800"
                                                    }, "✓"),
                                                    React.createElement('button', {
                                                        onClick: () => setEditingId(null),
                                                        className: "text-red-600 hover:text-red-800"
                                                    }, "✕")
                                                ) :
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('h3', { 
                                                        className: "text-xl font-bold",
                                                        style: { color: colors.text }
                                                    }, pkg.nickname),
                                                    React.createElement('button', {
                                                        onClick: () => {
                                                            setEditingId(pkg.id);
                                                            setEditNickname(pkg.nickname);
                                                        },
                                                        className: "text-gray-500 hover:text-gray-700"
                                                    }, React.createElement(Edit2, { className: "w-4 h-4" }))
                                                ),
                                            React.createElement('p', { className: "text-sm text-gray-600" }, pkg.tracking_number)
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-3 mt-3 sm:mt-0" },
                                            React.createElement('span', {
                                                className: "px-3 py-1 rounded-full text-sm font-semibold text-white",
                                                style: { backgroundColor: colors.primary }
                                            },
                                                React.createElement(Truck, { className: "w-4 h-4 inline mr-1" }),
                                                pkg.carrier
                                            ),
                                            React.createElement('button', {
                                                onClick: () => refreshPackage(pkg.id),
                                                disabled: isLoading,
                                                className: "text-gray-600 hover:text-gray-800 disabled:text-gray-400"
                                            }, React.createElement(RefreshCw, { className: `w-5 h-5 ${isLoading ? 'animate-spin' : ''}` })),
                                            React.createElement('button', {
                                                onClick: () => removePackage(pkg.id),
                                                className: "text-red-600 hover:text-red-800"
                                            }, "✕")
                                        )
                                    ),
                                    React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm" },
                                        React.createElement('div', null,
                                            React.createElement('p', { className: "font-semibold text-gray-700" }, "Status"),
                                            React.createElement('p', { style: { color: colors.primary } }, pkg.status)
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('p', { className: "font-semibold text-gray-700 flex items-center" },
                                                React.createElement(Clock, { className: "w-4 h-4 mr-1" }),
                                                "Estimated Delivery"
                                            ),
                                            React.createElement('p', { style: { color: colors.primary } }, pkg.estimated_delivery)
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('p', { className: "font-semibold text-gray-700" }, "Last Update"),
                                            React.createElement('p', { className: "text-gray-600" }, pkg.last_update)
                                        )
                                    ),
                                    pkg.location && React.createElement('div', { className: "mt-3 text-sm" },
                                        React.createElement('p', { className: "font-semibold text-gray-700" }, "Current Location"),
                                        React.createElement('p', { style: { color: colors.primary } }, pkg.location)
                                    )
                                )
                            );
                        })
                )
            );
        };

        ReactDOM.render(React.createElement(PackageTrackingApp), document.getElementById('root'));
    </script>
</body>
</html>