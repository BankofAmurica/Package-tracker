<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PackageTrackingApp = () => {
            const [packages, setPackages] = useState([]);
            const [newTracking, setNewTracking] = useState('');
            const [newNickname, setNewNickname] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [editNickname, setEditNickname] = useState('');

            // Load from localStorage on mount
            useEffect(() => {
                const saved = localStorage.getItem('packages');
                if (saved) {
                    try {
                        setPackages(JSON.parse(saved));
                    } catch (e) {
                        console.log('Error loading saved packages');
                    }
                }
            }, []);

            // Save to localStorage whenever packages change
            useEffect(() => {
                localStorage.setItem('packages', JSON.stringify(packages));
            }, [packages]);

            const detectCarrier = (trackingNumber) => {
                const cleaned = trackingNumber.replace(/\s+/g, '').toUpperCase();
                
                if (/^1Z[0-9A-Z]{16}$/.test(cleaned)) return 'UPS';
                if (/^[0-9]{12}$/.test(cleaned) || /^[0-9]{14}$/.test(cleaned)) return 'FedEx';
                if (/^[0-9]{15}$/.test(cleaned)) return 'FedEx';
                if (/^[0-9]{20}$/.test(cleaned)) return 'FedEx';
                if (/^(94|93|92|94)[0-9]{20}$/.test(cleaned)) return 'USPS';
                if (/^[A-Z]{2}[0-9]{9}[A-Z]{2}$/.test(cleaned)) return 'USPS';
                if (/^[0-9]{10,11}$/.test(cleaned)) return 'DHL';
                if (/^[0-9]{4}[0-9]{4}[0-9]{2}$/.test(cleaned)) return 'DHL';
                if (/^TBA[0-9]{12}$/.test(cleaned)) return 'Amazon';
                if (/^[A-Z]{2}[0-9]{9}[A-Z]{2}$/.test(cleaned)) return '17track';
                if (/^[0-9]{13}$/.test(cleaned)) return '17track';
                if (/^LP[0-9]{11}[A-Z]{2}$/.test(cleaned)) return '17track';
                if (/^[A-Z]{1}[A-Z0-9]{1}[0-9]{9}[A-Z]{2}$/.test(cleaned)) return '17track';
                if (/^YT[0-9]{16}$/.test(cleaned)) return '17track';
                
                return 'Unknown';
            };

            const getCarrierColors = (carrier) => {
                const colors = {
                    'UPS': { primary: '#8B4513', secondary: '#D2691E', bg: '#FFF8DC', text: '#654321' },
                    'FedEx': { primary: '#4B0082', secondary: '#FF6B35', bg: '#F8F4FF', text: '#4B0082' },
                    'USPS': { primary: '#004B87', secondary: '#ED1C24', bg: '#F0F8FF', text: '#003366' },
                    'DHL': { primary: '#FFCC00', secondary: '#DC143C', bg: '#FFFACD', text: '#B8860B' },
                    'Amazon': { primary: '#FF9900', secondary: '#146EB4', bg: '#FFF4E6', text: '#E47911' },
                    '17track': { primary: '#2563EB', secondary: '#1D4ED8', bg: '#EFF6FF', text: '#1E40AF' },
                    'Unknown': { primary: '#6B7280', secondary: '#9CA3AF', bg: '#F9FAFB', text: '#374151' }
                };
                return colors[carrier] || colors['Unknown'];
            };

            const generateMockTrackingData = (trackingNumber, carrier) => {
                const statuses = ['Label Created', 'Package Accepted', 'In Transit', 'Out for Delivery', 'Delivered'];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                const deliveryDate = new Date();
                deliveryDate.setDate(deliveryDate.getDate() + Math.floor(Math.random() * 5) + 1);
                
                return {
                    status: randomStatus,
                    estimatedDelivery: deliveryDate.toLocaleDateString(),
                    lastUpdate: new Date().toLocaleString(),
                    location: 'Distribution Center'
                };
            };

            const addPackage = async () => {
                if (!newTracking.trim()) return;
                
                setIsLoading(true);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const carrier = detectCarrier(newTracking);
                const trackingData = generateMockTrackingData(newTracking, carrier);
                
                const newPackage = {
                    id: Date.now(),
                    trackingNumber: newTracking.trim(),
                    nickname: newNickname.trim() || `Package ${packages.length + 1}`,
                    carrier,
                    ...trackingData
                };
                
                setPackages([newPackage, ...packages]);
                setNewTracking('');
                setNewNickname('');
                setIsLoading(false);
            };

            const refreshPackage = async (packageId) => {
                setIsLoading(true);
                
                await new Promise(resolve => setTimeout(resolve, 800));
                
                setPackages(packages.map(pkg => {
                    if (pkg.id === packageId) {
                        const updatedData = generateMockTrackingData(pkg.trackingNumber, pkg.carrier);
                        return { ...pkg, ...updatedData };
                    }
                    return pkg;
                }));
                
                setIsLoading(false);
            };

            const updateNickname = (packageId, newNickname) => {
                setPackages(packages.map(pkg => 
                    pkg.id === packageId ? { ...pkg, nickname: newNickname } : pkg
                ));
                setEditingId(null);
                setEditNickname('');
            };

            const removePackage = (packageId) => {
                setPackages(packages.filter(pkg => pkg.id !== packageId));
            };

            return (
                <div className="max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h1 className="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <span className="mr-3 text-2xl">üì¶</span>
                            Package Tracker
                        </h1>
                        <div className="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                            <p className="text-sm text-green-700">
                                ‚úÖ Status: Working with local storage - packages saved in your browser
                            </p>
                        </div>
                        <div className="bg-gray-50 p-4 rounded-lg mb-6">
                            <h2 className="text-xl font-semibold mb-4">Add New Package</h2>
                            <div className="flex flex-col sm:flex-row gap-3">
                                <input
                                    type="text"
                                    placeholder="Enter tracking number"
                                    value={newTracking}
                                    onChange={(e) => setNewTracking(e.target.value)}
                                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <input
                                    type="text"
                                    placeholder="Package nickname (optional)"
                                    value={newNickname}
                                    onChange={(e) => setNewNickname(e.target.value)}
                                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button
                                    onClick={addPackage}
                                    disabled={isLoading || !newTracking.trim()}
                                    className="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center"
                                >
                                    {isLoading ? (
                                        <span className="mr-2">‚è≥</span>
                                    ) : (
                                        <span className="mr-2">‚ûï</span>
                                    )}
                                    Add Package
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="space-y-4">
                        {packages.length === 0 ? (
                            <div className="bg-white rounded-lg shadow p-8 text-center">
                                <div className="text-6xl mb-4">üì¶</div>
                                <p className="text-gray-500 text-lg">No packages tracked yet</p>
                                <p className="text-gray-400">Add a tracking number above to get started</p>
                            </div>
                        ) : (
                            packages.map((pkg) => {
                                const colors = getCarrierColors(pkg.carrier);
                                return (
                                    <div
                                        key={pkg.id}
                                        className="bg-white rounded-lg shadow-md overflow-hidden"
                                        style={{ borderLeft: `6px solid ${colors.primary}` }}
                                    >
                                        <div 
                                            className="p-6" 
                                            style={{ backgroundColor: colors.bg }}
                                        >
                                            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4">
                                                <div className="flex-1">
                                                    {editingId === pkg.id ? (
                                                        <div className="flex items-center gap-2">
                                                            <input
                                                                type="text"
                                                                value={editNickname}
                                                                onChange={(e) => setEditNickname(e.target.value)}
                                                                className="text-xl font-bold bg-white border border-gray-300 rounded px-2 py-1"
                                                                onKeyPress={(e) => e.key === 'Enter' && updateNickname(pkg.id, editNickname)}
                                                                autoFocus
                                                            />
                                                            <button
                                                                onClick={() => updateNickname(pkg.id, editNickname)}
                                                                className="text-green-600 hover:text-green-800 text-lg"
                                                            >
                                                                ‚úì
                                                            </button>
                                                            <button
                                                                onClick={() => setEditingId(null)}
                                                                className="text-red-600 hover:text-red-800 text-lg"
                                                            >
                                                                ‚úï
                                                            </button>
                                                        </div>
                                                    ) : (
                                                        <div className="flex items-center gap-2">
                                                            <h3 
                                                                className="text-xl font-bold"
                                                                style={{ color: colors.text }}
                                                            >
                                                                {pkg.nickname}
                                                            </h3>
                                                            <button
                                                                onClick={() => {
                                                                    setEditingId(pkg.id);
                                                                    setEditNickname(pkg.nickname);
                                                                }}
                                                                className="text-gray-500 hover:text-gray-700"
                                                            >
                                                                ‚úèÔ∏è
                                                            </button>
                                                        </div>
                                                    )}
                                                    <p className="text-sm text-gray-600">{pkg.trackingNumber}</p>
                                                </div>
                                                
                                                <div className="flex items-center gap-3 mt-3 sm:mt-0">
                                                    <span
                                                        className="px-3 py-1 rounded-full text-sm font-semibold text-white flex items-center"
                                                        style={{ backgroundColor: colors.primary }}
                                                    >
                                                        <span className="mr-1">üöö</span>
                                                        {pkg.carrier}
                                                    </span>
                                                    <button
                                                        onClick={() => refreshPackage(pkg.id)}
                                                        disabled={isLoading}
                                                        className="text-gray-600 hover:text-gray-800 disabled:text-gray-400 text-lg"
                                                    >
                                                        {isLoading ? '‚è≥' : 'üîÑ'}
                                                    </button>
                                                    <button
                                                        onClick={() => removePackage(pkg.id)}
                                                        className="text-red-600 hover:text-red-800 text-lg"
                                                    >
                                                        ‚ùå
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
                                                <div>
                                                    <p className="font-semibold text-gray-700">Status</p>
                                                    <p style={{ color: colors.primary }}>{pkg.status}</p>
                                                </div>
                                                <div>
                                                    <p className="font-semibold text-gray-700 flex items-center">
                                                        <span className="mr-1">‚è∞</span>
                                                        Estimated Delivery
                                                    </p>
                                                    <p style={{ color: colors.primary }}>{pkg.estimatedDelivery}</p>
                                                </div>
                                                <div>
                                                    <p className="font-semibold text-gray-700">Last Update</p>
                                                    <p className="text-gray-600">{pkg.lastUpdate}</p>
                                                </div>
                                            </div>
                                            
                                            {pkg.location && (
                                                <div className="mt-3 text-sm">
                                                    <p className="font-semibold text-gray-700">Current Location</p>
                                                    <p style={{ color: colors.primary }}>{pkg.location}</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PackageTrackingApp />, document.getElementById('root'));
    </script>
</body>
</html>
